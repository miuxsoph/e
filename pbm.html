 <!DOCTYPE html>
<html>
<body>

<h2>NetPBM Generator</h2>

<form id="netpbmForm">
  <label for="width">Width:</label><br>
  <input type="text" id="width" name="width"><br>
  <label for="height">Height:</label><br>
  <input type="text" id="height" name="height"><br>
  <label for="bitField">Bit Field (0s and 1s only):</label><br>
  <textarea id="bitField" name="bitField" rows="4" cols="50"></textarea><br>
  <input type="checkbox" id="formatP4" name="formatP4">
  <label for="formatP4"> Use P4 format (If unchecked, P1 will be used)</label><br><br>
  <input type="button" value="Generate" onclick="generateNetPBM()">
  <a id="downloadLink" style="display: none">Download</a>
</form>

<script>
function generateNetPBM() {
  const width = document.getElementById("width").value;
  const height = document.getElementById("height").value;
  const bitField = document.getElementById("bitField").value;
  const formatP4 = document.getElementById("formatP4").checked;

  if (!width || !height || !bitField || !bitField.match(/^[01]+$/)) {
    alert("Invalid input");
    return;
  }

  if (formatP4) {
    const header = `P4\n${width} ${height}\n`;
    const rows = Math.ceil(bitField.length / width);
    const paddedWidth = Math.ceil(width / 8) * 8;
    let byteField = [];

    for (let row = 0; row < rows; row++) {
      for (let byteIndex = 0; byteIndex < paddedWidth / 8; byteIndex++) {
        let byteValue = 0;
        for (let bitIndex = 0; bitIndex < 8; bitIndex++) {
          const fieldIndex = row * width + byteIndex * 8 + bitIndex;
          if (fieldIndex < bitField.length && bitField[fieldIndex] === '1') {
            byteValue |= 1 << (7 - bitIndex);
          }
        }
        byteField.push(byteValue);
      }
    }
    const blob = new Blob([new TextEncoder().encode(header), new Uint8Array(byteField)], {type: "application/octet-stream"});
    const url = URL.createObjectURL(blob);

    const downloadLink = document.getElementById("downloadLink");
    downloadLink.href = url;
    downloadLink.download = `image.pbm`;
    downloadLink.style.display = "block";

  } else {
    const magicNumber = "P1";
    const netpbm = `${magicNumber}\n${width} ${height}\n${bitField}`;

    const blob = new Blob([netpbm], {type: "text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);

    const downloadLink = document.getElementById("downloadLink");
    downloadLink.href = url;
    downloadLink.download = `image.pbm`;
    downloadLink.style.display = "block";
  }
}
</script>

</body>
</html>

    
