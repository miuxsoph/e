 <!DOCTYPE html>
<html>
<body>

Width: <input type="text" id="width" value="106"><br>
Height: <input type="text" id="height" value="17"><br>
Bits: <input type="text" id="bits"><br>
Message: <input type="text" id="message"><br>
Binary: <input type="checkbox" id="binary"><br>

<button onclick="generatePBM()">Generate PBM</button>
<a id="downloadLink" style="display: none">Download PBM</a>

<script>
function generatePBM() {
    var width = document.getElementById('width').value;
    var height = document.getElementById('height').value;
    var bits = document.getElementById('bits').value;
    var message = document.getElementById('message').value;
    var binary = document.getElementById('binary').checked;

    const paddedWidth = Math.ceil(width / 8) * 8;
    let paddedBits = "";
    for (let y = 0; y < height; y++) {
        let row = bits.substr(y * width, width);
        row = row + '0'.repeat(paddedWidth - width);
        paddedBits += row;
    }
    paddedBits = paddedBits.substr(0, paddedWidth * height);
    
    var messageBits = '';
    for (var i = 0; i < message.length; i++) {
        messageBits += message[i].charCodeAt(0).toString(2).padStart(8, '0');
    }

    for (let i = 0; i < messageBits.length; i++) {
        paddedBits = setCharAt(paddedBits, i, messageBits.charAt(i));
    }

    var header = binary ? 'P4' : 'P1';
    var pbm = header + '\n' + paddedWidth + ' ' + height + '\n';

    if (binary) {
        for (var i = 0; i < paddedBits.length; i += 8) {
            pbm += String.fromCharCode(parseInt(paddedBits.substr(i, 8), 2));
        }
    } else {
        pbm += paddedBits;
    }

    // Create a Blob with the PBM data
    var blob = new Blob([pbm], {type: "text/plain"});
    var url = URL.createObjectURL(blob);

    // Update the download link
    var downloadLink = document.getElementById('downloadLink');
    downloadLink.href = url;
    downloadLink.download = 'image.pbm';
    downloadLink.style.display = 'block';
}

function setCharAt(str, index, chr) {
    if(index > str.length - 1) return str;
    return str.substring(0, index) + chr + str.substring(index + 1);
}
</script>

</body>
</html>
