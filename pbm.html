<!DOCTYPE html>

<html>
<head>
    <title>PBM Generator</title>
</head>
<body>
    <h1>PBM Generator</h1>
    <form id="pbm-form">
        <label for="width">Width:</label>
        <input type="number" id="width" name="width" required><br>
        <label for="height">Height:</label>
        <input type="number" id="height" name="height" required><br>
        <label for="bitfield">Bitfield:</label>
        <textarea id="bitfield" name="bitfield" required></textarea><br>
        <label for="binary">Binary Format:</label>
        <input type="checkbox" id="binary" name="binary"><br>
        <label for="text">Text to Hide:</label>
        <input type="text" id="text" name="text"><br>
        <input type="button" value="Generate PBM" onclick="generatePBM()">
    </form>

    <script>
        function generatePBM() {
            var width = document.getElementById('width').value;
            var height = document.getElementById('height').value;
            var bitfield = document.getElementById('bitfield').value;
            var binary = document.getElementById('binary').checked;
            var text = document.getElementById('text').value;

            if (binary) {
                var header = 'P4\n' + '# Created by PBM Generator\n' + width + ' ' + height + '\n';
                var bytes = [];
                var textBits = text.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join('');
                var newBitfield = '';
                for (var i = 0; i < bitfield.length; i++) {
                    newBitfield += bitfield[i] & (~1) | (textBits[i] || 0);
                }
                for (var i = 0; i < newBitfield.length; i += 8) {
                    bytes.push(parseInt(newBitfield.substr(i, 8), 2));
                }
                var pbm = header + String.fromCharCode.apply(null, bytes);
            } else {
                var header = 'P1\n' + '# Created by PBM Generator\n' + width + ' ' + height + '\n';
                var pbm = header + bitfield.replace(/(.{1})/g,"$1 ");
            }

            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(pbm));
            element.setAttribute('download', 'image.pbm');

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }
    </script>
</body>
</html>

